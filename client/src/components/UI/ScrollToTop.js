import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';

/**
 * Компонент ScrollToTop - невидимый помощник для автоматической прокрутки
 * Файл: client/src/components/UI/ScrollToTop.js
 *
 * Проблема, которую мы решаем:
 * В традиционных веб-сайтах каждый переход на новую страницу вызывает полную
 * перезагрузку, и браузер автоматически прокручивает к началу. Но в одностраничных
 * приложениях (SPA) переходы происходят через JavaScript, и браузер "не знает",
 * что нужно прокрутить наверх.
 *
 * Решение:
 * Этот компонент отслеживает изменения URL и имитирует поведение обычного веб-сайта,
 * автоматически прокручивая к началу страницы при каждом переходе.
 */
const ScrollToTop = () => {
    // useLocation возвращает объект с информацией о текущем маршруте
    // pathname - это часть URL после домена (например, "/categories/1")
    const { pathname } = useLocation();

    useEffect(() => {
        // Этот код выполняется каждый раз при изменении pathname

        // Почему мы используем setTimeout с нулевой задержкой?
        // Это важная техника в JavaScript, называемая "отложенное выполнение".
        // React Router может обновлять DOM асинхронно, и если мы попытаемся
        // прокрутить до того, как новый компонент полностью отрендерился,
        // прокрутка может не сработать или сработать некорректно.

        // setTimeout с задержкой 0 помещает нашу функцию в конец очереди
        // выполнения JavaScript, гарантируя, что она запустится после
        // всех синхронных операций, включая обновление DOM.
        setTimeout(() => {
            window.scrollTo({
                top: 0, // Прокручиваем в самый верх страницы
                left: 0, // И к левому краю (важно для горизонтальной прокрутки)
                behavior: 'smooth', // Плавная анимация вместо резкого скачка
            });
        }, 0);

        // Массив зависимостей [pathname] означает, что эффект будет
        // перезапускаться только при изменении pathname, а не при каждом рендере
    }, [pathname]);

    // Возвращаем null, поскольку этот компонент не должен ничего рендерить
    // Он существует только для выполнения побочного эффекта (прокрутки)
    return null;
};

export default ScrollToTop;
