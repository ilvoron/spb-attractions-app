const { sequelize } = require('./database');
const { User, Category, MetroStation, Attraction, Image } = require('../models');
const bcrypt = require('bcryptjs');

/**
 * –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
 * –§–∞–π–ª: server/config/database-seed.js
 *
 * –≠—Ç–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
 * 1. –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –º—è–≥–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –±–µ–∑ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
 * 2. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
 * 3. –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ ALTER –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
 *
 * –§–∏–ª–æ—Å–æ—Ñ–∏—è: "–õ—É—á—à–µ –∏–º–µ—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â—É—é —Å–∏—Å—Ç–µ–º—É, —á–µ–º —Å–æ–≤—Å–µ–º –Ω–µ —Ä–∞–±–æ—Ç–∞—é—â—É—é"
 */

async function addMissingColumns() {
    console.log('üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏...');

    try {
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ users
        const [results] = await sequelize.query(`
            SELECT column_name 
            FROM information_schema.columns 
            WHERE table_name = 'users' AND table_schema = 'public'
        `);

        const existingColumns = results.map((row) => row.column_name);
        console.log('–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ users:', existingColumns);

        // –°–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
        const newColumns = [
            {
                name: 'resetPasswordToken',
                definition: 'VARCHAR(255) NULL',
            },
            {
                name: 'resetPasswordExpires',
                definition: 'TIMESTAMP WITH TIME ZONE NULL',
            },
            {
                name: 'lastLoginAt',
                definition: 'TIMESTAMP WITH TIME ZONE NULL',
            },
            {
                name: 'loginAttempts',
                definition: 'INTEGER DEFAULT 0',
            },
            {
                name: 'lockedUntil',
                definition: 'TIMESTAMP WITH TIME ZONE NULL',
            },
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
        for (const column of newColumns) {
            if (!existingColumns.includes(column.name)) {
                console.log(`–î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É: ${column.name}`);
                try {
                    await sequelize.query(`
                        ALTER TABLE users 
                        ADD COLUMN "${column.name}" ${column.definition}
                    `);
                    console.log(`‚úÖ –ö–æ–ª–æ–Ω–∫–∞ ${column.name} –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`);
                } catch (error) {
                    console.log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É ${column.name}:, ${error.message}`);
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∞—Å—å
                }
            } else {
                console.log(`‚úÖ –ö–æ–ª–æ–Ω–∫–∞ ${column.name} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`);
            }
        }
    } catch (error) {
        console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–ª–æ–Ω–æ–∫:', error.message);
        console.log('–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π...');
    }
}

async function safeSyncModels() {
    console.log('üîÑ –í—ã–ø–æ–ª–Ω—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π...');

    try {
        // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤—Ä—É—á–Ω—É—é
        await addMissingColumns();

        // –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ–º –º—è–≥–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
        await sequelize.sync({
            force: false, // –ù–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
            alter: false, // –ù–µ –∏–∑–º–µ–Ω—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –º—ã —ç—Ç–æ –¥–µ–ª–∞–µ–º –≤—Ä—É—á–Ω—É—é
        });

        console.log('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
    } catch (error) {
        console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error.message);
        console.log('–ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π...');

        // –î–∞–∂–µ –µ—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–º —á—Ç–æ –µ—Å—Ç—å
        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
            await sequelize.authenticate();
            console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç');
        } catch (connectionError) {
            throw new Error(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: ${connectionError.message}`);
        }
    }
}

async function seedDatabase() {
    try {
        console.log('üå± –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');

        // –í—ã–ø–æ–ª–Ω—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
        await safeSyncModels();

        // 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        console.log('üë§ –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');

        const adminPassword = await bcrypt.hash('admin123', 12);
        const userPassword = await bcrypt.hash('user123', 12);

        const [admin, user] = await Promise.all([
            User.findOrCreate({
                where: { email: 'admin@spb-attractions.ru' },
                defaults: {
                    email: 'admin@spb-attractions.ru',
                    password: adminPassword,
                    role: 'admin',
                },
            }),
            User.findOrCreate({
                where: { email: 'user@example.com' },
                defaults: {
                    email: 'user@example.com',
                    password: userPassword,
                    role: 'user',
                },
            }),
        ]);

        console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã');

        // 2. –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        console.log('üìÇ –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...');

        const categories = [
            {
                name: '–ú—É–∑–µ–∏ –∏ –≥–∞–ª–µ—Ä–µ–∏',
                description: '–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º—É–∑–µ–∏, –≥–∞–ª–µ—Ä–µ–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–∞ –∏ –≤—ã—Å—Ç–∞–≤–æ—á–Ω—ã–µ –∑–∞–ª—ã',
                slug: 'museums-galleries',
                color: '#3B82F6',
            },
            {
                name: '–î–≤–æ—Ä—Ü—ã –∏ —É—Å–∞–¥—å–±—ã',
                description: '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –¥–≤–æ—Ä—Ü—ã, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —É—Å–∞–¥—å–±—ã –∏ –ø–∞—Ä–∫–æ–≤—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã',
                slug: 'palaces-estates',
                color: '#F59E0B',
            },
            {
                name: '–•—Ä–∞–º—ã –∏ —Å–æ–±–æ—Ä—ã',
                description: '–ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–µ —Ö—Ä–∞–º—ã, —Å–æ–±–æ—Ä—ã –∏ –¥—Ä—É–≥–∏–µ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏—è',
                slug: 'temples-cathedrals',
                color: '#10B981',
            },
            {
                name: '–ú–æ—Å—Ç—ã –∏ –Ω–∞–±–µ—Ä–µ–∂–Ω—ã–µ',
                description: '–ó–Ω–∞–º–µ–Ω–∏—Ç—ã–µ –º–æ—Å—Ç—ã –∏ –∂–∏–≤–æ–ø–∏—Å–Ω—ã–µ –Ω–∞–±–µ—Ä–µ–∂–Ω—ã–µ –≥–æ—Ä–æ–¥–∞',
                slug: 'bridges-embankments',
                color: '#8B5CF6',
            },
            {
                name: '–ü–∞—Ä–∫–∏ –∏ —Å–∞–¥—ã',
                description: '–ì–æ—Ä–æ–¥—Å–∫–∏–µ –ø–∞—Ä–∫–∏, –±–æ—Ç–∞–Ω–∏—á–µ—Å–∫–∏–µ —Å–∞–¥—ã –∏ –∑–æ–Ω—ã –æ—Ç–¥—ã—Ö–∞',
                slug: 'parks-gardens',
                color: '#EF4444',
            },
        ];

        const createdCategories = [];
        for (const categoryData of categories) {
            const [category] = await Category.findOrCreate({
                where: { name: categoryData.name },
                defaults: categoryData,
            });
            createdCategories.push(category);
        }

        console.log('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã');

        // 3. –°–æ–∑–¥–∞–µ–º —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ
        console.log('üöá –°–æ–∑–¥–∞–µ–º —Å—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ...');

        const metroStations = [
            { name: '–ù–µ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', lineColor: 'blue', lineName: '–°–∏–Ω—è—è –ª–∏–Ω–∏—è' },
            { name: '–ì–æ—Å—Ç–∏–Ω—ã–π –¥–≤–æ—Ä', lineColor: 'green', lineName: '–ó–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è' },
            { name: '–ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∞—è', lineColor: 'purple', lineName: '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è' },
            { name: '–°–ø–∞—Å—Å–∫–∞—è', lineColor: 'orange', lineName: '–û—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è' },
            { name: '–°–∞–¥–æ–≤–∞—è', lineColor: 'purple', lineName: '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è' },
            { name: '–í–∞—Å–∏–ª–µ–æ—Å—Ç—Ä–æ–≤—Å–∫–∞—è', lineColor: 'green', lineName: '–ó–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è' },
            { name: '–ì–æ—Ä—å–∫–æ–≤—Å–∫–∞—è', lineColor: 'purple', lineName: '–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –ª–∏–Ω–∏—è' },
        ];

        const createdStations = [];
        for (const stationData of metroStations) {
            const [station] = await MetroStation.findOrCreate({
                where: { name: stationData.name },
                defaults: stationData,
            });
            createdStations.push(station);
        }

        console.log('‚úÖ –°—Ç–∞–Ω—Ü–∏–∏ –º–µ—Ç—Ä–æ —Å–æ–∑–¥–∞–Ω—ã');

        // 4. –°–æ–∑–¥–∞–µ–º –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        console.log('üèõÔ∏è –°–æ–∑–¥–∞–µ–º –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...');

        const attractions = [
            {
                name: '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –≠—Ä–º–∏—Ç–∞–∂',
                slug: 'hermitage-museum',
                shortDescription:
                    '–û–¥–∏–Ω –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–µ–π—à–∏—Ö —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º—É–∑–µ–µ–≤ –º–∏—Ä–∞',
                fullDescription:
                    '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –≠—Ä–º–∏—Ç–∞–∂ ‚Äî –æ–¥–∏–Ω –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –∏ –Ω–∞–∏–±–æ–ª–µ–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ –∫—É–ª—å—Ç—É—Ä–Ω–æ-–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º—É–∑–µ–µ–≤ –†–æ—Å—Å–∏–∏ –∏ –º–∏—Ä–∞. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –≠—Ä–º–∏—Ç–∞–∂–∞ –±—ã–ª–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞ –∏–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–µ–π –ï–∫–∞—Ç–µ—Ä–∏–Ω–æ–π II –≤ 1764 –≥–æ–¥—É. –°–µ–≥–æ–¥–Ω—è –º—É–∑–µ–π –æ–±–ª–∞–¥–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π, –Ω–∞—Å—á–∏—Ç—ã–≤–∞—é—â–µ–π –±–æ–ª–µ–µ —Ç—Ä—ë—Ö –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π –∏—Å–∫—É—Å—Å—Ç–≤–∞ –∏ –ø–∞–º—è—Ç–Ω–∏–∫–æ–≤ –º–∏—Ä–æ–≤–æ–π –∫—É–ª—å—Ç—É—Ä—ã.',
                address: '–î–≤–æ—Ä—Ü–æ–≤–∞—è –ø–ª–æ—â–∞–¥—å, 2',
                district: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π',
                latitude: 59.9398,
                longitude: 30.3146,
                workingHours: '–í—Ç-–°–±: 10:00-18:00, –í—Å: 10:00-17:00, –ü–Ω - –≤—ã—Ö–æ–¥–Ω–æ–π',
                ticketPrice: '–æ—Ç 400‚ÇΩ, –ª—å–≥–æ—Ç–Ω—ã–π 200‚ÇΩ',
                website: 'https://hermitagemuseum.org',
                phone: '+7 (812) 710-90-79',
                distanceToMetro: 3,
                wheelchairAccessible: true,
                hasElevator: true,
                hasAudioGuide: true,
                hasSignLanguageSupport: false,
                accessibilityNotes: '–î–æ—Å—Ç—É–ø –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–Ω—ã—Ö –∫–æ–ª—è—Å–æ–∫ —á–µ—Ä–µ–∑ —Å–ª—É–∂–µ–±–Ω—ã–π –≤—Ö–æ–¥',
                isPublished: true,
                categoryId: createdCategories[0].id,
                metroStationId: createdStations[1].id,
                createdBy: admin[0].id,
            },
            {
                name: '–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å',
                slug: 'petropavlovsk-fortress',
                shortDescription: '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, –∑–∞–ª–æ–∂–µ–Ω–Ω–æ–µ –ü–µ—Ç—Ä–æ–º I –≤ 1703 –≥–æ–¥—É',
                fullDescription:
                    '–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å ‚Äî —Ü–∏—Ç–∞–¥–µ–ª—å –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–∞—è –Ω–∞ –ó–∞—è—á—å–µ–º –æ—Å—Ç—Ä–æ–≤–µ, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –≥–æ—Ä–æ–¥–∞. –ó–∞–ª–æ–∂–µ–Ω–∞ 16 (27) –º–∞—è 1703 –≥–æ–¥–∞ –ø–æ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º—É –ø–ª–∞–Ω—É –ü–µ—Ç—Ä–∞ I –∏ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ñ–æ–∑–µ—Ñ–∞-–ì–∞—Å–ø–∞—Ä–∞ –õ–∞–º–±–µ—Ä–∞ –¥–µ –ì–µ—Ä–µ–Ω–∞. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∏–π —Å–æ–±–æ—Ä —Å —É—Å—ã–ø–∞–ª—å–Ω–∏—Ü–µ–π —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, –í–µ–ª–∏–∫–æ–∫–Ω—è–∂–µ—Å–∫—É—é —É—Å—ã–ø–∞–ª—å–Ω–∏—Ü—É, –¢—Ä—É–±–µ—Ü–∫–æ–π –±–∞—Å—Ç–∏–æ–Ω —Å —Ç—é—Ä—å–º–æ–π –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –º—É–∑–µ–µ–≤.',
                address: '–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å, 3',
                district: '–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∏–π',
                latitude: 59.9496,
                longitude: 30.3164,
                workingHours: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ: 06:00-21:00, –º—É–∑–µ–∏: 10:00-18:00',
                ticketPrice: '–í—Ö–æ–¥ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –º—É–∑–µ–∏ –æ—Ç 250‚ÇΩ',
                website: 'https://spbmuseum.ru',
                phone: '+7 (812) 230-64-31',
                distanceToMetro: 10,
                wheelchairAccessible: false,
                hasElevator: false,
                hasAudioGuide: true,
                hasSignLanguageSupport: false,
                accessibilityNotes: '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –±—Ä—É—Å—á–∞—Ç–∫–∞, –µ—Å—Ç—å –ø–∞–Ω–¥—É—Å—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–¥–∞–Ω–∏—è—Ö',
                isPublished: true,
                categoryId: createdCategories[2].id,
                metroStationId: createdStations[6].id,
                createdBy: admin[0].id,
            },
            {
                name: '–î–≤–æ—Ä—Ü–æ–≤—ã–π –º–æ—Å—Ç',
                slug: 'palace-bridge',
                shortDescription:
                    '–û–¥–∏–Ω –∏–∑ —Å–∏–º–≤–æ–ª–æ–≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, —Å–æ–µ–¥–∏–Ω—è—é—â–∏–π –î–≤–æ—Ä—Ü–æ–≤—É—é –ø–ª–æ—â–∞–¥—å —Å –í–∞—Å–∏–ª—å–µ–≤—Å–∫–∏–º –æ—Å—Ç—Ä–æ–≤–æ–º',
                fullDescription:
                    '–î–≤–æ—Ä—Ü–æ–≤—ã–π –º–æ—Å—Ç ‚Äî –æ–¥–∏–Ω –∏–∑ –∫—Ä–∞—Å–∏–≤–µ–π—à–∏—Ö —Ä–∞–∑–≤–æ–¥–Ω—ã—Ö –º–æ—Å—Ç–æ–≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞ —á–µ—Ä–µ–∑ –ë–æ–ª—å—à—É—é –ù–µ–≤—É. –°–æ–µ–¥–∏–Ω—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å –≥–æ—Ä–æ–¥–∞ (–î–≤–æ—Ä—Ü–æ–≤—É—é –ø–ª–æ—â–∞–¥—å) –∏ –í–∞—Å–∏–ª—å–µ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤. –ü–æ—Å—Ç—Ä–æ–µ–Ω –≤ 1912-1916 –≥–æ–¥–∞—Ö –ø–æ –ø—Ä–æ–µ–∫—Ç—É –∏–Ω–∂–µ–Ω–µ—Ä–∞ –ê. –ü. –ü—à–µ–Ω–∏—Ü–∫–æ–≥–æ. –î–ª–∏–Ω–∞ –º–æ—Å—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 260,1 –º–µ—Ç—Ä–∞, —à–∏—Ä–∏–Ω–∞ ‚Äî 27,8 –º–µ—Ç—Ä–∞. –ú–æ—Å—Ç —Ä–∞–∑–≤–æ–¥–∏—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ –ø–µ—Ä–∏–æ–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.',
                address: '–î–≤–æ—Ä—Ü–æ–≤—ã–π –º–æ—Å—Ç',
                district: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π',
                latitude: 59.9387,
                longitude: 30.3067,
                workingHours: '–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, —Ä–∞–∑–≤–æ–¥–∫–∞: 01:10-02:50',
                ticketPrice: '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ',
                website: null,
                phone: null,
                distanceToMetro: 5,
                wheelchairAccessible: true,
                hasElevator: false,
                hasAudioGuide: false,
                hasSignLanguageSupport: false,
                accessibilityNotes: '–ü–µ—à–µ—Ö–æ–¥–Ω—ã–µ —Ç—Ä–æ—Ç—É–∞—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∫–æ–ª—è—Å–æ–∫',
                isPublished: true,
                categoryId: createdCategories[3].id,
                metroStationId: createdStations[2].id,
                createdBy: admin[0].id,
            },
            {
                name: '–õ–µ—Ç–Ω–∏–π —Å–∞–¥',
                slug: 'summer-garden',
                shortDescription: '–°—Ç–∞—Ä–µ–π—à–∏–π —Å–∞–¥ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, –∑–∞–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ –ø–æ–≤–µ–ª–µ–Ω–∏—é –ü–µ—Ç—Ä–∞ I –≤ 1704 –≥–æ–¥—É',
                fullDescription:
                    '–õ–µ—Ç–Ω–∏–π —Å–∞–¥ ‚Äî –ø–∞—Ä–∫ –≤ —Ü–µ–Ω—Ç—Ä–µ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, –ø–∞–º—è—Ç–Ω–∏–∫ —Å–∞–¥–æ–≤–æ-–ø–∞—Ä–∫–æ–≤–æ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–∞ –ø–µ—Ä–≤–æ–π —Ç—Ä–µ—Ç–∏ XVIII –≤–µ–∫–∞. –ó–∞–ª–æ–∂–µ–Ω –≤ 1704 –≥–æ–¥—É –ø–æ –ø–æ–≤–µ–ª–µ–Ω–∏—é –ü–µ—Ç—Ä–∞ I. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–º —Ä–µ–∫–∞–º–∏ –ù–µ–≤–æ–π, –§–æ–Ω—Ç–∞–Ω–∫–æ–π, –ú–æ–π–∫–æ–π –∏ –õ–µ–±—è–∂—å–∏–º –∫–∞–Ω–∞–ª–æ–º. –°–∞–¥ —É–∫—Ä–∞—à–µ–Ω –º—Ä–∞–º–æ—Ä–Ω—ã–º–∏ —Å–∫—É–ª—å–ø—Ç—É—Ä–∞–º–∏, —Å—Ä–µ–¥–∏ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–±–æ—Ç—ã –∑–Ω–∞–º–µ–Ω–∏—Ç—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ XVII-XVIII –≤–µ–∫–æ–≤.',
                address: '–Ω–∞–±. –ö—É—Ç—É–∑–æ–≤–∞, 2',
                district: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π',
                latitude: 59.9421,
                longitude: 30.337,
                workingHours: '–ú–∞–π-—Å–µ–Ω—Ç—è–±—Ä—å: 10:00-22:00, –æ–∫—Ç—è–±—Ä—å-–∞–ø—Ä–µ–ª—å: 10:00-20:00',
                ticketPrice: '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ',
                website: 'https://rusmuseum.ru',
                phone: '+7 (812) 595-42-48',
                distanceToMetro: 7,
                wheelchairAccessible: true,
                hasElevator: false,
                hasAudioGuide: false,
                hasSignLanguageSupport: false,
                accessibilityNotes: '–ê—Å—Ñ–∞–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–æ—Ä–æ–∂–∫–∏, –µ—Å—Ç—å –ø–∞–Ω–¥—É—Å—ã',
                isPublished: true,
                categoryId: createdCategories[4].id,
                metroStationId: createdStations[1].id,
                createdBy: admin[0].id,
            },
            {
                name: '–ò—Å–∞–∞–∫–∏–µ–≤—Å–∫–∏–π —Å–æ–±–æ—Ä',
                slug: 'saint-isaac-cathedral',
                shortDescription: '–ö—Ä—É–ø–Ω–µ–π—à–∏–π –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π —Ö—Ä–∞–º –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞, –≤—ã–¥–∞—é—â–∏–π—Å—è –ø–∞–º—è—Ç–Ω–∏–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã',
                fullDescription:
                    '–ò—Å–∞–∞–∫–∏–µ–≤—Å–∫–∏–π —Å–æ–±–æ—Ä ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–∏–π –ø—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π —Ö—Ä–∞–º –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω –Ω–∞ –ò—Å–∞–∞–∫–∏–µ–≤—Å–∫–æ–π –ø–ª–æ—â–∞–¥–∏. –ü–æ—Å—Ç—Ä–æ–µ–Ω –≤ 1818‚Äî1858 –≥–æ–¥–∞—Ö –ø–æ –ø—Ä–æ–µ–∫—Ç—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ –û–≥—é—Å—Ç–∞ –¥–µ –ú–æ–Ω—Ñ–µ—Ä—Ä–∞–Ω–∞; —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∫—É—Ä–∏—Ä–æ–≤–∞–ª –∏–º–ø–µ—Ä–∞—Ç–æ—Ä –ù–∏–∫–æ–ª–∞–π I. –û—Å–≤—è—â—ë–Ω –≤–æ –∏–º—è –ø—Ä–µ–ø–æ–¥–æ–±–Ω–æ–≥–æ –ò—Å–∞–∞–∫–∏—è –î–∞–ª–º–∞—Ç—Å–∫–æ–≥–æ, –¥–µ–Ω—å –ø–∞–º—è—Ç–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–≤–ø–∞–¥–∞–ª —Å –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è –ü–µ—Ç—Ä–∞ I. –í—ã—Å–æ—Ç–∞ —Å–æ–±–æ—Ä–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 101,5 –º–µ—Ç—Ä–∞.',
                address: '–ò—Å–∞–∞–∫–∏–µ–≤—Å–∫–∞—è –ø–ª., 4',
                district: '–ê–¥–º–∏—Ä–∞–ª—Ç–µ–π—Å–∫–∏–π',
                latitude: 59.9342,
                longitude: 30.3062,
                workingHours: '–ß—Ç-–í—Ç: 10:30-18:00, —Å—Ä–µ–¥–∞ - –≤—ã—Ö–æ–¥–Ω–æ–π',
                ticketPrice: '–æ—Ç 350‚ÇΩ, –∫–æ–ª–æ–Ω–Ω–∞–¥–∞ –æ—Ç 200‚ÇΩ',
                website: 'https://cathedral.ru',
                phone: '+7 (812) 315-97-32',
                distanceToMetro: 4,
                wheelchairAccessible: false,
                hasElevator: true,
                hasAudioGuide: true,
                hasSignLanguageSupport: false,
                accessibilityNotes: '–ì–ª–∞–≤–Ω—ã–π –≤—Ö–æ–¥ –∏–º–µ–µ—Ç —Å—Ç—É–ø–µ–Ω–∏, –µ—Å—Ç—å –ø–æ–¥—ä–µ–º–Ω–∏–∫ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–Ω—ã—Ö –∫–æ–ª—è—Å–æ–∫',
                isPublished: true,
                categoryId: createdCategories[2].id,
                metroStationId: createdStations[2].id,
                createdBy: admin[0].id,
            },
        ];

        for (const attractionData of attractions) {
            await Attraction.findOrCreate({
                where: { name: attractionData.name },
                defaults: attractionData,
            });
        }

        console.log('‚úÖ –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω—ã');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        const totalAttractions = await Attraction.count();
        const totalCategories = await Category.count();
        const totalUsers = await User.count();

        console.log('\nüéâ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!');
        console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:`);
        console.log(`   üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${totalUsers}`);
        console.log(`   üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: ${totalCategories}`);
        console.log(`   üèõÔ∏è –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π: ${totalAttractions}`);
        console.log(`   üöá –°—Ç–∞–Ω—Ü–∏–π –º–µ—Ç—Ä–æ: ${createdStations.length}`);

        console.log('\nüîê –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:');
        console.log('   –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: admin@spb-attractions.ru / admin123');
        console.log('   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user@example.com / user123');
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
        console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error.message);

        // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å stack trace, –Ω–æ –¥–∞–µ–º –ø–æ–ª–µ–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        if (error.name === 'SequelizeDatabaseError') {
            console.log('\nüí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:');
            console.log('1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL');
            console.log('2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞');
            console.log('3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
        }
    } finally {
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        await sequelize.close();
        console.log('\nüëã –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–æ');
        process.exit(0);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ —Ñ–∞–π–ª –≤—ã–∑–≤–∞–Ω –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
    seedDatabase();
}

module.exports = { seedDatabase };
